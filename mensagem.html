<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerar Report Bloqueio WhatsApp</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f9f9f9;
      padding: 20px;
      margin: 0;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    h1 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 1.5rem;
    }

    label {
      text-align: left;
      font-weight: bold;
      font-size: 14px;
    }

    input, textarea, select {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    textarea {
      height: 100px;
    }

    button {
      padding: 14px;
      font-size: 16px;
      background-color: #25d366;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      font-weight: bold;
    }

    button:hover {
      background-color: #1ebe57;
    }

    .btn-secondary {
      background-color: #007bff;
    }

    .btn-secondary:hover {
      background-color: #0056b3;
    }

    /* Campos extras escondidos por padr√£o */
    #bloqueioOutro, #detalhesSubstituicao {
      display: none;
    }

    pre {
      text-align: left;
      background: #f5f5f5;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
      white-space: pre-wrap;
      font-size: 14px;
    }

    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }

    /* Responsividade */
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
      .container {
        padding: 15px;
      }
      h1 {
        font-size: 1.3rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Gerar Report Bloqueio</h1>

    <form>
      <label for="numero">N√∫mero WhatsApp</label>
      <input type="tel" id="numero" placeholder="+351 912 345 678 (P/ validar insira o seu!)" inputmode="numeric">
    
      <label for="encomenda">Encomenda:</label>
      <input
        type="text"
        id="encomenda"
        name="encomenda"
        placeholder="Ex: 00035625 / 530729"
        required
        inputmode="numeric"
      />
      <small id="erro-encomenda" style="color:red; display:none;">
      ‚ö†Ô∏è O n√∫mero ap√≥s a barra deve ter exatamente 6 d√≠gitos.
      </small>


      <label for="bloqueio">Tipo de Bloqueio</label>
      <select id="bloqueio" onchange="mostrarOutro()">
        <option value="">-- Selecione o tipo de bloqueio --</option>
        <option>Erro "encomenda em processamento"</option>
        <option>O valor do pedido √© superior ao valor permitido</option>
        <option>Erro de duplicidade</option>
        <option>Erro descohecido</option>
        <option>Outro (especificar abaixo)</option>
      </select>

      <label for="bloqueioOutro" class="visually-hidden">Especifique o tipo de bloqueio</label>
      <input type="text" id="bloqueioOutro" placeholder="Digite o tipo de bloqueio">

      <label for="substituicao">Houve substitui√ß√£o?</label>
      <select id="substituicao" onchange="mostrarDescricaoSubstituicao()">
        <option value="">-- Selecione --</option>
        <option>Sim, teve substitui√ß√£o</option>
        <option>N√£o teve substitui√ß√£o</option>
        <option>N√£o teve substitui√ß√£o mas quero adicionar nota/descri√ß√£o</option>
      </select>

      <label for="detalhesSubstituicao" class="visually-hidden">Detalhes da substitui√ß√£o ou nota adicional</label>
      <textarea id="detalhesSubstituicao" placeholder="Descreva os artigos substitu√≠dos ou a nota adicional..."></textarea>

      <label for="ticket">Ticket</label>
      <input type="number" id="ticket" placeholder="1832377" inputmode="numeric">

      <button type="button" onclick="gerarMensagem()">Gerar Mensagem</button>
      <button type="button" class="btn-secondary" onclick="enviarWhatsApp()">Abrir no WhatsApp</button>
    </form>

    <h3>Pr√©via da Mensagem:</h3>
    <pre id="preview" aria-live="polite"></pre>

    <div class="visually-hidden" aria-live="polite" id="status-announcer"></div>
  </div>

  <script>
    let mensagemGerada = "";

    function mostrarOutro() {
      const select = document.getElementById("bloqueio");
      const outroCampo = document.getElementById("bloqueioOutro");

      if (select.value === "Outro (especificar abaixo)") {
        outroCampo.style.display = "block";
        outroCampo.focus();
      } else {
        outroCampo.style.display = "none";
        outroCampo.value = "";
      }
    }

    function mostrarDescricaoSubstituicao() {
      const select = document.getElementById("substituicao");
      const campoDescricao = document.getElementById("detalhesSubstituicao");

      if (
        select.value === "Sim, teve substitui√ß√£o" ||
        select.value === "N√£o teve substitui√ß√£o mas quero adicionar nota/descri√ß√£o"
      ) {
        campoDescricao.style.display = "block";
        campoDescricao.focus();
      } else {
        campoDescricao.style.display = "none";
        campoDescricao.value = "";
      }
    }

    function gerarMensagem() {
      const encomenda = document.getElementById("encomenda").value;
      let bloqueio = document.getElementById("bloqueio").value;
      const bloqueioOutro = document.getElementById("bloqueioOutro").value;
      const substituicao = document.getElementById("substituicao").value;
      const detalhes = document.getElementById("detalhesSubstituicao").value;
      const ticket = document.getElementById("ticket").value;

      if (bloqueio === "Outro (especificar abaixo)" && bloqueioOutro.trim() !== "") {
        bloqueio = bloqueioOutro;
      }

      let textoSubstituicao = substituicao;
      if (detalhes.trim() !== "") {
        textoSubstituicao += `\n\n${detalhes}`;
      }

      const agora = new Date();
      const horas = String(agora.getHours()).padStart(2, '0');
      const minutos = String(agora.getMinutes()).padStart(2, '0');
      const horaFormatada = `${horas}:${minutos}`;

      mensagemGerada =
`Report Bloqueio

Encomenda: ${encomenda}
Tipo do Bloqueio: ${bloqueio}
Substitui√ß√£o: ${textoSubstituicao}

J√° contactado o 2370 - ${horaFormatada}

Ticket: ${ticket}`;

      document.getElementById("preview").innerText = mensagemGerada;
      const announcer = document.getElementById('status-announcer');

      // Copiar para a √°rea de transfer√™ncia
      navigator.clipboard.writeText(mensagemGerada).then(() => {
        // Feedback visual
        const botao = document.querySelector("button[onclick='gerarMensagem()']");
        const textoOriginal = botao.innerText;
        botao.innerText = "Copiado!";
        setTimeout(() => {
          botao.innerText = textoOriginal;
        }, 2000);

        // Feedback para leitores de tela
        announcer.textContent = 'Mensagem copiada para a √°rea de transfer√™ncia.';
        setTimeout(() => { announcer.textContent = '' }, 3000);

      }).catch(err => {
        console.error("Erro ao copiar a mensagem: ", err);
        announcer.textContent = 'Ocorreu um erro ao copiar a mensagem.';
        setTimeout(() => { announcer.textContent = '' }, 3000);
        alert("Ocorreu um erro ao copiar a mensagem.");
      });
    }

    function enviarWhatsApp() {
      const numero = document.getElementById("numero").value;
      if (!numero || !mensagemGerada) {
        alert("Preencha o n√∫mero e gere a mensagem antes de enviar!");
        return;
      }
      const url = `https://wa.me/${numero}?text=${encodeURIComponent(mensagemGerada)}`;
      window.open(url, "_blank");
    }

    // üì± M√°scara telefone
    document.getElementById("numero").addEventListener("input", function(e) {
      let valor = e.target.value.replace(/\D/g, "");
      if(valor.startsWith("351")) {
        valor = "+" + valor.replace(/^351/, "351 ");
      } else if(valor.startsWith("55")) {
        valor = "+" + valor.replace(/^55/, "55 ");
      }
      valor = valor.replace(/(\+\d{2,3})(\d{3})(\d{3})(\d{3})$/, "$1 $2 $3 $4");
      e.target.value = valor;
    });

    // üì¶ M√°scara encomenda
    document.getElementById("encomenda").addEventListener("input", function(e) {
      let valor = e.target.value.replace(/\D/g, "");
      if (valor.length > 8) {
        valor = valor.slice(0, 8) + " / " + valor.slice(8);
      }
      e.target.value = valor;
    });

    // üé´ Ticket s√≥ n√∫meros
    document.getElementById("ticket").addEventListener("input", function(e) {
      e.target.value = e.target.value.replace(/\D/g, ""); 
    });

    const campoEncomenda = document.getElementById("encomenda");
  const erro = document.getElementById("erro-encomenda");

  campoEncomenda.addEventListener("input", function(e) {
    let valor = e.target.value.replace(/[^0-9/]/g, ""); // s√≥ n√∫meros e "/"
    
    // Se j√° tem "/", divide em duas partes
    if (valor.includes("/")) {
      let [antes, depois] = valor.split("/");

      // Remove espa√ßos extras
      antes = antes.trim();
      depois = depois.trim();

      // Limita a parte depois da "/" a 6 d√≠gitos
      depois = depois.slice(0, 6);

      valor = antes + " / " + depois;

      // Valida√ß√£o: precisa ter exatamente 6 d√≠gitos depois da barra
      if (depois.length === 6) {
        erro.style.display = "none";
        campoEncomenda.setCustomValidity(""); 
      } else {
        erro.style.display = "block";
        campoEncomenda.setCustomValidity("O n√∫mero ap√≥s a barra deve ter exatamente 6 d√≠gitos.");
      }
    }

    e.target.value = valor;
  });
  </script>
</body>
</html>
